<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yoga Playlist Generator</title>
    <link rel="stylesheet" href="css/main.css">
    <base href="https://yoga-playlist-app.vercel.app/">
      <!-- Load CSS with absolute path -->
    <link rel="stylesheet" href="https://yoga-playlist-app.vercel.app/css/main.css">
    <!-- fairydust SDK -->
    <script src="https://fairydust.fun/sdk/index.umd.js"></script>
    <link rel="stylesheet" href="https://fairydust.fun/sdk/fairydust.css">
    <script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]);var n=t;if("undefined"!=typeof e)try{n=t[e]}catch(r){}return n}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_wANN8fAdn8bek8ZzbcZpZGOzRp6TfOfVPvW7CKq3B6m',{api_host:'https://app.posthog.com'})
    </script>
</head>
<body>
    <div class="container">
        <header class="header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>üßò‚Äç‚ôÄÔ∏è Yoga Playlist Generator</h1>
                <p>Creates a personalized playlist and connects to Spotify</p>
            </div>
            <div id="fairydust-account"></div>
        </header>

        <!-- Success/Status Message Area (replaces status bar) -->
        <div id="success-area" class="success-area" style="display: none;">
            <div id="success-content"></div>
        </div>

        <div class="main-content">
            <div class="input-panel">
                <h2>Describe Your Class</h2>
                
                <form id="playlist-form">
                    <div class="form-group">
                        <label for="class-type">Class Type</label>
                        <select id="class-type" required>
                            <option value="">Loading classes...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="music-preferences">Music Style & Preferences</label>
                        <textarea id="music-preferences" placeholder="Optional - provide some direction to the AI..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="duration">Class Duration: <span id="duration-display">60</span> minutes</label>
                        <input type="range" id="duration" min="30" max="90" value="60" step="15">
                        <div class="duration-labels">
                            <span>30min</span>
                            <span>45min</span>
                            <span>60min</span>
                            <span>75min</span>
                            <span>90min</span>
                        </div>
                    </div>

                    <button type="submit" id="generate-btn" class="generate-btn" style="display: none;">
                        <span class="btn-text">Generate Playlist</span>
                        <span class="btn-loading">üîÑ Generating...</span>
                    </button>
                    <!-- fairydust payment button -->
                    <div id="fairydust-generate-button"></div>
                </form>
            </div>

            <div class="output-panel">
                <div id="output-content">
                    <div class="placeholder">
                        <h3>Your Playlist Will Appear Here</h3>
                        <p>Fill out the form and click "Generate Playlist" to create your custom playlist.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="export-section" class="export-section" style="display: none;">
            <div class="export-panel">
                <h3>üéµ Export to Spotify</h3>
                <p>Your playlist is ready! Click below to create it in your Spotify account.</p>
                <div class="export-controls">
                    <input type="text" id="playlist-name" placeholder="Enter playlist name" value="">
                    <button id="export-btn" class="export-btn">Create Spotify Playlist</button>
                </div>
                <div id="export-result"></div>
            </div>
        </div>

        <!-- Status Bar moved to bottom 
        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">Backend:</span>
                <span id="backend-status" class="status-value">Checking...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Spotify:</span>
                <span id="spotify-status" class="status-value">Checking...</span>
            </div>
        </div> -->
        <div id="share-section" class="share-section" style="display: none;">
            <div class="share-panel">
                <h3>üí´ Share This App</h3>
                <p>Invite others to discover personalized playlist creation!</p>
                <div class="share-buttons">
                    <button id="copy-link-btn" class="share-btn copy-btn">üìã Copy Link</button>
                    <button id="share-twitter-btn" class="share-btn twitter-btn">üê¶ Share on Twitter</button>
                    <button id="share-linkedin-btn" class="share-btn linkedin-btn">üíº Share on LinkedIn</button>
                </div>
            </div>
        </div>
    </div>

    <!-- fairydust Integration -->
    <script>
        // Initialize fairydust
        const fairydust = new Fairydust.Fairydust({
            appId: '4c890b06-e8a0-494e-9445-5fad2e1124af'  // Approved Yoga Playlist Generator
        });

        // Create account widget
        fairydust.createAccountComponent('#fairydust-account', {
            onConnect: (user) => {
                console.log('fairydust user connected:', user);
            },
            onDisconnect: () => {
                console.log('fairydust user disconnected');
            }
        });

        // Dynamic pricing based on duration
        function getDustCost() {
            const duration = parseInt(document.getElementById('duration').value || 60);
            return duration <= 45 ? 5 : 8;  // 5 DUST for ‚â§45min, 8 DUST for >45min
        }

        // Update button based on form state
        function updateFairydustButton() {
            const cost = getDustCost();
            const duration = document.getElementById('duration').value || 60;
            const classType = document.getElementById('class-type').value;
            
            const buttonLabel = duration <= 45 
                ? `Generate Playlist (${cost} DUST)` 
                : `Generate Extended Playlist (${cost} DUST)`;

            fairydust.createButtonComponent('#fairydust-generate-button', {
                dustCost: cost,
                label: buttonLabel,
                disabled: !classType,  // Disable if no class type selected
                onSuccess: async (transaction) => {
                    console.log('fairydust payment successful:', transaction);
                    
                    // Trigger the original generate function
                    const originalBtn = document.getElementById('generate-btn');
                    if (originalBtn) {
                        originalBtn.click();
                    }
                },
                onError: (error) => {
                    console.error('fairydust payment failed:', error);
                    alert('Payment failed: ' + error);
                }
            });
        }

        // Update button when duration or class type changes
        document.addEventListener('DOMContentLoaded', () => {
            updateFairydustButton();
            
            document.getElementById('duration').addEventListener('input', updateFairydustButton);
            document.getElementById('class-type').addEventListener('change', updateFairydustButton);
        });
    </script>

    <script src="js/app.js"></script>
</body>
</html>